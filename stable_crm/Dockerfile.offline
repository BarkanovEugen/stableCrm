# Автономная версия с установкой Hex
FROM elixir:1.15

# Создаем рабочую директорию
WORKDIR /app

# Копируем конфигурацию
COPY mix.exs mix.lock ./
COPY config config/

# Устанавливаем Hex и rebar (обязательно для компиляции)
RUN mix local.hex --force
RUN mix local.rebar --force

# Устанавливаем зависимости
RUN mix deps.get --only prod

# Копируем исходный код
COPY lib lib/
COPY priv priv/

# Компилируем
RUN mix compile

# Запуск
CMD ["mix", "phx.server"]
