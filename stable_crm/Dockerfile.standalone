# Полностью автономная версия без внешних зависимостей
FROM elixir:1.15

# Создаем рабочую директорию
WORKDIR /app

# Копируем все файлы проекта (включая deps/ если есть)
COPY . .

# Пытаемся запустить без компиляции
# Если есть скомпилированные файлы - используем их
# Если нет - запускаем в режиме интерпретации
CMD ["sh", "-c", "if [ -d '_build' ]; then mix phx.server; else echo 'Starting in interpretation mode...' && mix run --no-halt; fi"]
