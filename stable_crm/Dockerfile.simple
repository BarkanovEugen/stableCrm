# Простая версия с готовым образом Elixir
FROM elixir:1.15

# Создаем рабочую директорию
WORKDIR /app

# Копируем конфигурацию
COPY mix.exs mix.lock ./
COPY config config/

# Устанавливаем зависимости через GitHub (обход проблем с сетью)
RUN mix archive.install github hexpm/hex branch latest --force && \
    mix local.rebar --force && \
    mix deps.get --only prod

# Копируем исходный код
COPY lib lib/
COPY priv priv/

# Компилируем
RUN mix compile

# Создаем релиз
RUN mix release

# Запуск
CMD ["mix", "phx.server"]
